<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Krushn's Hacktoberfest Tracker</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 8px;
      }

      /* Navigation styles */
      nav {
        border: 2px solid #2c3e50;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 20px;
      }

      nav a {
        text-decoration: none;
        padding: 10px 20px;
        margin-right: 10px;
        background: #d9dadb;
        border-radius: 5px;
        color: black;
        display: inline-block;
      }

      nav a:hover {
        background: #bdbdbd;
      }

      /* Review status badge styles */
      .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        text-transform: capitalize;
        display: inline-block;
      }

      .status-badge.pending {
        background: #e5e7eb;
        color: #6b7280;
      }

      .status-badge.in_review {
        background: #dbeafe;
        color: #3b82f6;
      }

      .status-badge.approved {
        background: #d1fae5;
        color: #10b981;
      }

      .status-badge.changes_requested {
        background: #fed7aa;
        color: #f59e0b;
      }

      .status-badge.merged {
        background: #e9d5ff;
        color: #8b5cf6;
      }

      /* PR status badge styles */
      .pr-status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        display: inline-block;
      }

      .pr-status-badge.pr-merged {
        background: #e9d5ff;
        color: #8b5cf6;
      }

      .pr-status-badge.pr-open {
        background: #dcfce7;
        color: #16a34a;
      }

      .pr-status-badge.pr-closed {
        background: #fee2e2;
        color: #dc2626;
      }

      /* Badge label styles */
      .badge-label {
        font-size: 10px;
        color: #6b7280;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 2px;
        display: block;
      }

      .badge-container {
        display: inline-block;
        margin-right: 8px;
        text-align: center;
      }

      /* ID column styles */
      .pr-id {
        font-weight: bold;
        color: #3b82f6;
        font-size: 14px;
      }

      .view-details-btn {
        padding: 6px 12px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .view-details-btn:hover {
        background: #2563eb;
      }

      /* Filter section styles */
      .filters-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .filters-section h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
      }

      .filter-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }

      .filter-group label {
        font-weight: bold;
        margin-right: 10px;
        color: #666;
        min-width: 120px;
      }

      .filter-btn {
        padding: 8px 16px;
        border: 1px solid #e5e7eb;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }

      .filter-btn:hover {
        background: #f9fafb;
      }

      .filter-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .search-box {
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        width: 300px;
      }

      .clear-filters-btn {
        padding: 8px 16px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }

      .clear-filters-btn:hover {
        background: #dc2626;
      }

      .filter-summary {
        margin-top: 10px;
        padding: 10px;
        background: #f3f4f6;
        border-radius: 4px;
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="/review-dashboard.html">Review Status Dashboard</a>
    </nav>

    <div id="app">
      <h1>Krushn's Hacktoberfest Tracker</h1>

      <table v-if="statistics">
        <tr>
          <td>Total PRs</td>
          <td>{{ statistics.totalPRs }}</td>
        </tr>
        <tr>
          <td>Merged PRs</td>
          <td>{{ statistics.mergedPRs }}</td>
        </tr>
        <tr>
          <td>Open PRs</td>
          <td>{{ statistics.openPRs }}</td>
        </tr>
        <tr>
          <td>Closed PRs</td>
          <td>{{ statistics.closedPRs }}</td>
        </tr>
        <tr>
          <td>Total Repositories</td>
          <td>{{ statistics.totalRepositories }}</td>
        </tr>
        <tr>
          <td>Red-Flagged Repositories</td>
          <td>{{ statistics.redFlaggedRepositories }}</td>
        </tr>
        <tr>
          <td>Total Users</td>
          <td>{{ statistics.totalUsers }}</td>
        </tr>
        <tr>
          <td>Total Colleges</td>
          <td>{{ statistics.totalColleges }}</td>
        </tr>
        <tr>
          <td>Total Owners</td>
          <td>{{ statistics.totalOwners }}</td>
        </tr>
      </table>

      <div v-if="statistics && statistics.reviewStats" style="margin-top: 20px;">
        <h3>Review Status Summary</h3>
        <table>
          <tr>
            <td>Pending Review</td>
            <td><span class="status-badge pending">{{ statistics.reviewStats.pending || 0 }}</span></td>
          </tr>
          <tr>
            <td>In Review</td>
            <td><span class="status-badge in_review">{{ statistics.reviewStats.in_review || 0 }}</span></td>
          </tr>
          <tr>
            <td>Approved</td>
            <td><span class="status-badge approved">{{ statistics.reviewStats.approved || 0 }}</span></td>
          </tr>
          <tr>
            <td>Changes Requested</td>
            <td><span class="status-badge changes_requested">{{ statistics.reviewStats.changes_requested || 0 }}</span></td>
          </tr>
          <tr>
            <td>Merged</td>
            <td><span class="status-badge merged">{{ statistics.reviewStats.merged || 0 }}</span></td>
          </tr>
        </table>
      </div>

      <h2>Pull Requests</h2>

      <!-- Filters Section -->
      <div class="filters-section">
        <h3>Filter Pull Requests</h3>
        
        <div class="filter-group">
          <label>Review Status:</label>
          <button 
            class="filter-btn" 
            :class="{ active: filters.reviewStatus === 'all' }"
            @click="setFilter('reviewStatus', 'all')"
          >
            All
          </button>
          <button 
            class="filter-btn status-badge pending" 
            :class="{ active: filters.reviewStatus === 'pending' }"
            @click="setFilter('reviewStatus', 'pending')"
          >
            Pending
          </button>
          <button 
            class="filter-btn status-badge in_review" 
            :class="{ active: filters.reviewStatus === 'in_review' }"
            @click="setFilter('reviewStatus', 'in_review')"
          >
            In Review
          </button>
          <button 
            class="filter-btn status-badge approved" 
            :class="{ active: filters.reviewStatus === 'approved' }"
            @click="setFilter('reviewStatus', 'approved')"
          >
            Approved
          </button>
          <button 
            class="filter-btn status-badge changes_requested" 
            :class="{ active: filters.reviewStatus === 'changes_requested' }"
            @click="setFilter('reviewStatus', 'changes_requested')"
          >
            Changes Requested
          </button>
          <button 
            class="filter-btn status-badge merged" 
            :class="{ active: filters.reviewStatus === 'merged' }"
            @click="setFilter('reviewStatus', 'merged')"
          >
            Merged
          </button>
        </div>

        <div class="filter-group">
          <label>PR Status:</label>
          <button 
            class="filter-btn" 
            :class="{ active: filters.prStatus === 'all' }"
            @click="setFilter('prStatus', 'all')"
          >
            All
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: filters.prStatus === 'open' }"
            @click="setFilter('prStatus', 'open')"
          >
            Open
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: filters.prStatus === 'merged' }"
            @click="setFilter('prStatus', 'merged')"
          >
            Merged
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: filters.prStatus === 'closed' }"
            @click="setFilter('prStatus', 'closed')"
          >
            Closed
          </button>
        </div>

        <div class="filter-group">
          <label>Search:</label>
          <input 
            type="text" 
            class="search-box" 
            v-model="filters.searchQuery"
            @input="applyFilters"
            placeholder="Search by title, author, or repo..."
          />
          <button class="clear-filters-btn" @click="clearFilters">
            Clear All Filters
          </button>
        </div>

        <div class="filter-summary">
          Showing {{ filteredPRs.length }} of {{ prs.length }} PRs
          <span v-if="activeFiltersCount > 0">
            ({{ activeFiltersCount }} filter{{ activeFiltersCount > 1 ? 's' : '' }} active)
          </span>
        </div>
      </div>

      <table v-if="filteredPRs.length">
        <thead>
          <tr>
            <td v-if="statistics" colspan="9">
              Visible PRs: {{ filteredPRs.length }} | Hidden PRs: {{ statistics.totalPRs
              - filteredPRs.length }}
            </td>
          </tr>
          <tr>
            <th>ID</th>
            <th>Author</th>
            <th>Owner</th>
            <th>Repository</th>
            <th>PR Status</th>
            <th>Review Status</th>
            <th>Title</th>
            <th>Link</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="pr in filteredPRs" :key="pr._id">
            <td>
              <span class="pr-id">{{ pr.stableId }}</span>
            </td>
            <td>
              <p>{{ pr.author.full_name }}</p>
              <p>{{ pr.author.username }}</p>
              <p>
                {{ pr.author.college?.name }} - {{ pr.author.college?.year }}
              </p>
              <p>{{ pr.author.role }}</p>
            </td>

            <td>{{ pr.repository.owner.username }}</td>

            <td>
              {{ pr.repository.name }}

              Is Self Repo? {{pr.repository.owner.username === pr.author.username ? 'Yes' : 'No'}}

              <button @click="redFlagRepository(pr.repository._id)">
                Mark Red Flag
              </button>
            </td>

            <td>
              <div class="badge-container">
                <span v-if="pr.is_merged" class="pr-status-badge pr-merged">Merged</span>
                <span v-else-if="pr.is_open" class="pr-status-badge pr-open">Open</span>
                <span v-else class="pr-status-badge pr-closed">Closed</span>
              </div>
            </td>

            <td>
              <div class="badge-container">
                <span 
                  v-if="pr.review_status" 
                  :class="'status-badge ' + pr.review_status"
                >
                  {{ pr.review_status.replace('_', ' ') }}
                </span>
                <span v-else class="status-badge pending">pending</span>
              </div>
              <div v-if="pr.reviewers && pr.reviewers.length" style="margin-top: 8px; font-size: 11px; color: #666;">
                <strong>Reviewers:</strong> {{ pr.reviewers.join(', ') }}
              </div>
            </td>

            <td>{{ pr.title }}</td>

            <td><a :href="pr.link" target="_blank">View PR</a></td>

            <td>
              <button 
                class="view-details-btn"
                @click="viewReviewDetails(pr._id)"
              >
                View Details
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div v-else-if="prs.length > 0" style="padding: 20px; text-align: center; color: #666;">
        No PRs match the current filters. Try adjusting your filters or 
        <button @click="clearFilters" style="color: #3b82f6; text-decoration: underline; background: none; border: none; cursor: pointer;">
          clear all filters
        </button>
      </div>
    </div>

    <script src="/main.js"></script>

    <script>
      /**
      const statistics = {
        totalPRs,
        mergedPRs,
        openPRs,
        closedPRs,
        totalRepositories,
        redFlaggedRepositories,
        totalUsers,
        totalColleges,
        totalOwners,
      }
      */

      /** 
      const PR = {
        _id: '68e985090744826b0baffecb',
        github_id: 3498445179,
        title: 'Humra namm Utsav h',
        body: null,
        author: {
          _id: '68e9800352e4adee99aebad8',
          username: 'UtsavDoye20122005',
          github_id: 71711535,
          full_name: 'UTSAV DOYE',
          college: {
            _id: '68e9800352e4adee99aebad5',
            name: 'NST SVYASA',
            __v: 0,
            createdAt: '2025-10-10T21:52:03.676Z',
            updatedAt: '2025-10-10T21:52:03.676Z',
          },
          year: '1st Year',
          role: 'student',
          createdAt: '2025-10-10T21:52:03.694Z',
          updatedAt: '2025-10-10T21:52:03.694Z',
          __v: 0,
        },
        repository: {
          _id: '68e985090744826b0baffec8',
          github_id: 1072838275,
          name: 'fork-pr-activity',
          owner: {
            _id: '68e985080744826b0baffec5',
            github_id: 235483496,
            name: null,
            username: 'adarsh-inst',
            type: 'User',
            createdAt: '2025-10-10T22:13:28.851Z',
            updatedAt: '2025-10-10T22:13:28.851Z',
            __v: 0,
          },
          is_gosc: false,
          is_redFlagged: false,
          createdAt: '2025-10-10T22:13:29.357Z',
          updatedAt: '2025-10-10T22:13:29.357Z',
          __v: 0,
        },
        is_open: false,
        is_merged: true,
        is_redFlagged: false,
        redFlag_reason: '',
        redFlag_by: null,
        redFlag_at: null,
        createdAt: '2025-10-09T09:52:39.000Z',
        updatedAt: '2025-10-10T22:36:04.092Z',
        __v: 0,
        link: 'https://github.com/adarsh-inst/fork-pr-activity/pull/40',
      }
      */
    </script>
  </body>
</html>
